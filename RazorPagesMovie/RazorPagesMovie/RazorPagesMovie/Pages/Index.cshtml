@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="min-h-[410px] p-4">

    <section class="mb-4">
        <div class="mx-auto">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl leading-tight font-normal">Users</h1>
                <a href="javascript:;" id="createUserLink"
                    class="bg-[#007bff] hover:bg-blue-600 text-white p-[7px] px-3 font-normal rounded flex items-center">
                    <i class="fa fa-plus-square mr-1"></i>
                    Create
                </a>
            </div>
        </div>
    </section>

    <section>
        <div class="mt-[-4px] mx-auto">
            <div class="bg-white shadow rounded">
                <div class="border-b">
                    <div class="flex justify-between py-3 px-5">
                        <div class="flex-1">
                        </div>
                        <div class="flex-1">
                            <div class="relative">
                                <form id="UsersSearchForm" class="flex">
                                    <button type="button" class="bg-blue-500 text-white px-3 py-1.5 rounded-l">
                                        <span class="fas fa-search" aria-hidden="true"></span>
                                    </button>
                                    <input type="text" name="Keyword"
                                        class="w-full h-[38px] pl-3 rounded-r border border-gray-300 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none">
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="px-5 py-6">
                    <div>
                        <div id="UsersTable_wrapper" class="dataTables_wrapper">
                            <div class="flex">
                                <div class="w-full">
                                    <table id="UsersTable"
                                        class="min-w-full border-collapse border border-slate-400 text-sm">
                                        <thead class="border-b-[3px] border-gray-300 custom-border ">
                                            <tr class="font-medium text-left">
                                                <th class="border p-2 w-2/12" rowspan="1" colspan="1">
                                                    User name</th>
                                                <th class="border p-2 w-2/12" rowspan="1" colspan="1">
                                                    Full name</th>
                                                <th class="border p-2 w-5/12" rowspan="1" colspan="1">
                                                    Email address</th>
                                                <th class="border p-2 w-2/12" rowspan="1" colspan="1">
                                                    Is active</th>
                                                <th class="border p-2 w-1/12" rowspan="1" colspan="1">
                                                    Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white">
                                            <tr class="h-12 text-left whitespace-nowrap">
                                                <td class="border p-2" data-user-name="admin">admin</td>
                                                <td class="border p-2" data-user-fullname="admin admin">admin admin</td>
                                                <td class="border p-2" data-user-email="admin@aspnetboilerplate.com">
                                                    admin@aspnetboilerplate.com</td>
                                                <td class="border p-2 pr-4">
                                                    <input type="checkbox" disabled checked>
                                                </td>
                                                <td class="border p-2 text-sm">
                                                    <button type="button" id="editUserLink"
                                                        class="bg-[#6c757d] hover:bg-gray-400 text-white font-bold py-1.5 px-2 rounded"
                                                        data-user-id="1" data-toggle="modal"
                                                        data-target="#UserEditModal">
                                                        <i class="fas fa-pencil-alt"></i> Edit
                                                    </button>
                                                    <button type="button" id="deleteUserButton"
                                                        class="bg-red-500 hover:bg-red-600 text-white font-bold py-1.5 px-2 rounded"
                                                        data-user-id="1" data-user-name="admin">
                                                        <i class="fas fa-trash"></i> Delete
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr class="h-12 text-left whitespace-nowrap">
                                                <td class="border p-2">admin</td>
                                                <td class="border p-2">admin admin</td>
                                                <td class="border p-2">
                                                    admin@aspnetboilerplate.com</td>
                                                <td class="border p-2">
                                                    <input type="checkbox" disabled checked>
                                                </td>
                                                <td class="border p-2 text-sm">
                                                    <button type="button" id="editUserLink"
                                                        class="bg-[#6c757d] hover:bg-gray-400 text-white font-bold py-1.5 px-2 rounded"
                                                        data-user-id="1" data-toggle="modal"
                                                        data-target="#UserEditModal">
                                                        <i class="fas fa-pencil-alt"></i> Edit
                                                    </button>
                                                    <button type="button"
                                                        class="bg-red-500 hover:bg-red-600 text-white font-bold py-1.5 px-2 rounded"
                                                        data-user-id="1" data-user-name="admin">
                                                        <i class="fas fa-trash"></i> Delete
                                                    </button>
                                                </td>
                                            </tr>

                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="grid grid-cols-12 gap-4 mt-4 text-sm">
                                <div class="col-span-1 flex items-center justify-start">
                                    <button
                                        class="w-[40px] h-[35px] bg-[#6d757d] hover:bg-[#5a6268] rounded flex items-center justify-center"
                                        aria-controls="UsersTable" type="button">
                                        <i class="fas fa-redo-alt w-3.5 h-3.5 text-white mb-[3px]"></i>
                                    </button>
                                </div>
                                <div class="col-span-3 text-left flex flex-col justify-end pb-0.5">
                                    <span>1-1 of 1 items</span>
                                </div>
                                <div class="col-span-7 flex items-start ml-36">
                                    <label>
                                        Show
                                        <select name="UsersTable_length"
                                            class="ml-2 border border-gray-300 rounded py-1 px-2 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none">
                                            <option value="10">10</option>
                                            <option value="25">25</option>
                                            <option value="50">50</option>
                                            <option value="100">100</option>
                                        </select>
                                        entries
                                    </label>
                                </div>
                                <div class="col-span-1 flex justify-end items-center">
                                    <ul class="inline-flex -space-x-px">
                                        <li>
                                            <a href="#"
                                                class="px-3 py-2 rounded-l border border-gray-300 text-gray-500 hover:bg-gray-200 hover:text-gray-700">
                                                <i class="fas fa-chevron-left"></i>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#"
                                                class="px-3 py-2 border border-gray-300 bg-blue-500 text-white">1</a>
                                        </li>
                                        <li>
                                            <a href="#"
                                                class="px-3 py-2 rounded-r border border-gray-300 text-gray-500 hover:bg-gray-200 hover:text-gray-700">
                                                <i class="fas fa-chevron-right"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Modal Create -->
    <div id="UserCreateModal"
        class="fixed inset-0 flex items-start justify-center bg-black bg-opacity-50 hidden transition-opacity duration-300 z-50">
        <div class="bg-white rounded shadow-lg max-w-full w-5/12 transform -translate-y-full transition-transform duration-300 mt-7"
            id="modalContent">
            <div class="p-4 border-b flex justify-between items-center">
                <h5 class="text-xl font-normal text-[#212529]">Create new user</h5>
                <button id="closeCreateModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <form name="userCreateForm" class="p-4" novalidate>

                <ul class="flex border-b">
                    <li class="py-2 px-4">
                        <button type="button" class="tablink active" data-tab="create-user-details"
                            onclick="showTabCreate(event, 'create-user-details')">User details</button>
                    </li>
                    <li class="py-2 px-4">
                        <button type="button" class="tablink text-[#3990ff]" data-tab="create-user-roles"
                            onclick="showTabCreate(event, 'create-user-roles')">User roles</button>
                    </li>
                </ul>

                <div class="tab-content mt-4">
                    <div class="tab-pane active text-base font-semibold mb-10" id="create-user-details">
                        <div class="flex justify-between items-center mt-6 mb-4">
                            <label class="block">User name <span class="text-red-700">*</span></label>
                            <input type="text"
                                class="border border-gray-300 rounded px-3 py-1.5 w-3/4 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none"
                                name="UserName" required maxlength="256" minlength="2" aria-invalid="false">
                        </div>
                        <div class="flex justify-between items-center mb-4">
                            <label class="block">Name <span class="text-red-700">*</span></label>
                            <input type="text"
                                class="border border-gray-300 rounded px-3 py-1.5 w-3/4 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none"
                                name="Name" required maxlength="256" minlength="2" aria-invalid="false">
                        </div>
                        <div class="flex justify-between items-center mb-4">
                            <label class="block">Surname <span class="text-red-700">*</span></label>
                            <input type="text"
                                class="border border-gray-300 rounded px-3 py-1.5 w-3/4 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none"
                                name="Surname" required maxlength="256" minlength="2" aria-invalid="false">
                        </div>
                        <div class="flex justify-between items-center mb-4">
                            <label class="block">Email address <span class="text-red-700">*</span></label>
                            <input type="email"
                                class="border border-gray-300 rounded px-3 py-1.5 w-3/4 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none"
                                name="Email" required>
                        </div>
                        <div class="flex justify-between items-center mb-4">
                            <label class="block">Password <span class="text-red-700">*</span></label>
                            <input type="password"
                                class="border border-gray-300 rounded px-3 py-1.5 w-3/4 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none"
                                name="Password" required>
                        </div>
                        <div class="flex justify-between items-center mb-4">
                            <label class="block">Confirm password <span class="text-red-700">*</span></label>
                            <input type="password"
                                class="border border-gray-300 rounded px-3 py-1.5 w-3/4 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none"
                                name="Confirm Password" required>
                        </div>
                        <div class="flex justify-start items-center mb-4">
                            <label class="block">Is active</label>
                            <input type="checkbox" class="ml-[136px]" name="IsActive" value="true" checked>
                        </div>
                    </div>
                    <div class="tab-pane hidden mb-6" id="create-user-roles">
                        <div class="flex items-center mb-2">
                            <input type="checkbox" name="role" id="role-1" value="ADMIN" class="mr-1">
                            <label for="role-1" class="font-semibold">Admin</label>
                        </div>
                    </div>
                </div>
                <div class="border-t">
                    <div class="mt-4 flex flex-row justify-between">
                        <button type="button" id="cancelCreateModal"
                            class="bg-[#f8f9fa] hover:bg-[#e9ecef] text-gray-800 px-3 py-1.5 rounded  border border-gray-300">Cancel</button>
                        <button type="submit"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded">Save</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Edit -->
    <div id="UserEditModal"
        class="fixed inset-0 flex items-start justify-center bg-black bg-opacity-50 hidden transition-opacity duration-300 z-50">
        <div class="bg-white rounded shadow-lg max-w-full w-5/12 transform -translate-y-full transition-transform duration-300 mt-7"
            id="modalEditContent">
            <div class="p-4 border-b flex justify-between items-center">
                <h5 class="text-xl font-normal text-[#212529]">Edit user</h5>
                <button id="closeEditModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <form name="userEditForm" class="p-4" novalidate>

                <ul class="flex border-b">
                    <li class="py-2 px-4">
                        <button type="button" class="tablinkEdit active" data-tab-edit="edit-user-details"
                            onclick="showTabEdit(event, 'edit-user-details')">User details</button>
                    </li>
                    <li class="py-2 px-4">
                        <button type="button" class="tablinkEdit text-[#3990ff]" data-tab-edit="edit-user-roles"
                            onclick="showTabEdit(event, 'edit-user-roles')">User roles</button>
                    </li>
                </ul>

                <div class="tab-content mt-4">
                    <div class="tab-pane-edit active text-base font-semibold mb-10" id="edit-user-details">
                        <div class="flex justify-between items-center mt-6 mb-4">
                            <label class="block">User name <span class="text-red-700">*</span></label>
                            <input type="text"
                                class="border border-gray-300 rounded px-3 py-1.5 w-3/4 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none"
                                name="UserName" required maxlength="256" minlength="2" aria-invalid="false">
                        </div>
                        <div class="flex justify-between items-center mb-4">
                            <label class="block">Name <span class="text-red-700">*</span></label>
                            <input type="text"
                                class="border border-gray-300 rounded px-3 py-1.5 w-3/4 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none"
                                name="Name" required maxlength="256" minlength="2" aria-invalid="false">
                        </div>
                        <div class="flex justify-between items-center mb-4">
                            <label class="block">Surname <span class="text-red-700">*</span></label>
                            <input type="text"
                                class="border border-gray-300 rounded px-3 py-1.5 w-3/4 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none"
                                name="Surname" required maxlength="256" minlength="2" aria-invalid="false">
                        </div>
                        <div class="flex justify-between items-center mb-4">
                            <label class="block">Email address <span class="text-red-700">*</span></label>
                            <input type="email"
                                class="border border-gray-300 rounded px-3 py-1.5 w-3/4 focus:outline-none focus:ring-0 focus:border-ring-focus shadow-none"
                                name="Email" required>
                        </div>
                        <div class="flex justify-start items-center mb-4">
                            <label class="block">Is active</label>
                            <input type="checkbox" class="ml-[136px]" name="IsActive" value="true" checked>
                        </div>
                    </div>
                    <div class="tab-pane-edit hidden mb-6" id="edit-user-roles">
                        <div class="flex items-center mb-2">
                            <input type="checkbox" name="role" id="role-1" value="ADMIN" class="mr-1">
                            <label for="role-1" class="font-semibold">Admin</label>
                        </div>
                    </div>
                </div>
                <div class="border-t">
                    <div class="mt-4 flex flex-row justify-between">
                        <button type="button" id="cancelEditModal"
                            class="bg-[#f8f9fa] hover:bg-[#e9ecef] text-gray-800 px-3 py-1.5 rounded  border border-gray-300">Cancel</button>
                        <button type="submit"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded">Save</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    @section Scripts {
        <script>
            //1.Chọn background cho row trong table
            const rows = document.querySelectorAll('#UsersTable tbody tr');
            rows.forEach((row, index) => {
                if (index % 2 == 0) { // Kiểm tra nếu là dòng chẵn
                    row.classList.add('bg-[#f2f2f2]');
                }
            });

            //2.Gán sự kiện click cho nút "Create"
            document.getElementById('createUserLink').addEventListener('click', function () {
                const modal = document.getElementById('UserCreateModal');
                const modalContent = document.getElementById('modalContent');

                // Hiển thị modal và áp dụng hiệu ứng
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    modalContent.classList.remove('-translate-y-full');
                }, 500);
            });

            //3. Chuyển đổi giữa các tab create
            const tabsCreate = document.querySelectorAll('.tablink');
            const tabCreatePanes = document.querySelectorAll('.tab-pane');
            function showTabCreate(event, targetTab) {
                tabCreatePanes.forEach(pane => pane.classList.add('hidden'));

                tabsCreate.forEach(tab => {
                    tab.classList.remove('active', 'text-[#495057]');
                    tab.classList.add('text-[#3990ff]');
                });

                document.getElementById(targetTab).classList.remove('hidden');
                event.currentTarget.classList.add('active', 'text-[#495057]');
            }
            tabsCreate.forEach(tab => {
                tab.addEventListener('click', function () {
                    showTabCreate(event, this.getAttribute('data-tab'));
                });
            });

            //4.Đóng modal create
            document.getElementById('closeCreateModal').addEventListener('click', closeCreateModal);
            document.getElementById('cancelCreateModal').addEventListener('click', closeCreateModal);
            function closeCreateModal() {
                const modal = document.getElementById('UserCreateModal');
                const modalContent = document.getElementById('modalContent');

                // Thêm lại hiệu ứng khi đóng
                modalContent.classList.add('-translate-y-full');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.add('opacity-0');
                }, 300);
            }

            //5.Gán sự kiện click cho nút "Edit"
            document.getElementById('editUserLink').addEventListener('click', function () {
                const modal = document.getElementById('UserEditModal');
                const modalContent = document.getElementById('modalEditContent');

                // Lấy dữ liệu từ bảng và điền vào các ô input trong modal
                const userName = document.querySelector('tr [data-user-name]').getAttribute('data-user-name');
                const userFullname = document.querySelector('tr [data-user-fullname]').getAttribute('data-user-fullname');
                const userEmail = document.querySelector('tr [data-user-email]').getAttribute('data-user-email');

                modal.querySelectorAll('input').forEach(input => {
                    input.classList.add('text-gray-300');
                    input.classList.add('font-normal');
                });
                modal.querySelector('input[name="UserName"]').value = userName;
                modal.querySelector('input[name="Name"]').value = userFullname.split(' ')[0];
                modal.querySelector('input[name="Surname"]').value = userFullname.split(' ')[1];
                modal.querySelector('input[name="Email"]').value = userEmail;

                // Hiển thị modal và áp dụng hiệu ứng
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    modalContent.classList.remove('-translate-y-full');
                }, 500);
            });

            //6. Chuyển đổi giữa các tab edit
            const tabsEdit = document.querySelectorAll('.tablinkEdit');
            const tabEditPanes = document.querySelectorAll('.tab-pane-edit');
            function showTabEdit(event, targetTab) {
                tabEditPanes.forEach(pane => pane.classList.add('hidden'));

                tabsEdit.forEach(tab => {
                    tab.classList.remove('active', 'text-[#495057]');
                    tab.classList.add('text-[#3990ff]');
                });

                document.getElementById(targetTab).classList.remove('hidden');
                event.currentTarget.classList.add('active', 'text-[#495057]');
            }
            tabsEdit.forEach(tab => {
                tab.addEventListener('click', function () {
                    showTabEdit(event, this.getAttribute('data-tab-edit'));
                });
            });

            //7.Đóng modal edit
            document.getElementById('closeEditModal').addEventListener('click', closeEditModal);
            document.getElementById('cancelEditModal').addEventListener('click', closeEditModal);
            function closeEditModal() {
                const modal = document.getElementById('UserEditModal');
                const modalContent = document.getElementById('modalEditContent');

                // Thêm lại hiệu ứng khi đóng
                modalContent.classList.add('-translate-y-full');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.add('opacity-0');
                }, 300);
            }

            //8. Delete
            document.getElementById('deleteUserButton').addEventListener('click', () => {
                Swal.fire({
                    icon: 'warning',
                    title: 'Are you sure?',
                    text: 'Do you want to delete this admin?',
                    showCancelButton: true,
                    confirmButtonColor: '#7cd1f9',
                    cancelButtonColor: '#efefef',
                    cancelButtonText: 'Cancel',
                    confirmButtonText: 'Yes',
                    customClass: {
                        popup: 'rounded-lg shadow-lg p-4',
                        title: 'text-xl font-bold text-gray-800',
                        content: 'text-gray-600 mb-4',
                        actions: 'flex justify-end space-x-4 absolute bottom-0 right-4',
                        cancelButton: 'font-semibold text-gray-500 order-first px-4 py-2',
                        confirmButton: 'font-semibold text-blue-600 order-last px-4 py-2 right-4'
                    }
                });
            });


        </script>
    }